<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>작업허가 상세 · CMMS</title>
    <!-- common CSS is loaded via layout/defaultLayout -->
    <!-- local fallback for design-only preview without server -->
    <link rel="stylesheet" href="../../static/assets/css/base.css" />
    <link rel="stylesheet" href="../../static/assets/css/print.css" />
  </head>
  <body>
    <div class="page">
      <header class="appbar">
        <div class="appbar-inner">
          <div class="brand">작업관리</div>
          <div class="spacer"></div>
          <div class="meta">
            <span class="badge">memberId</span>
            <span>운영팀</span>
          </div>
        </div>
      </header>
      <nav class="breadcrumbs">
        <div class="container">
          <a th:href="@{#}" href="#">작업관리</a>
          <span class="sep">/</span>
          <a th:href="@{/workpermit/list}">작업허가</a>
          <span class="sep">/</span>
          <span>상세</span>
        </div>
      </nav>
      <!-- Main Content -->
      <section data-slot-root th:fragment="content" data-page="workpermit-detail" data-module="workpermit-detail">
        <main>
        <div class="container">
          <section class="card">
            <div class="card-header">
              <div class="row" style="width:100%;justify-content:space-between">
                <div class="card-title">작업허가 상세</div>
                <div class="toolbar">
                  <a class="btn" th:href="@{/workpermit/list}">목록</a>
                  <a class="btn" href="#" data-print-btn>인쇄</a>
                  <a class="btn" th:href="@{/workpermit/edit/{id}(id=${workpermit.permitId})}">수정</a>
                  <button class="btn danger" 
                          th:data-delete-url="@{/workpermit/delete/{id}(id=${workpermit.permitId})}"
                          data-redirect="@{/workpermit/list}"
                          data-confirm="정말 삭제하시겠습니까?">삭제</button>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="section">
                <div class="section-title">기본정보</div>
                <div class="grid cols-12">
                  <div class="stack col-span-3"><div class="label">허가 번호</div><div th:text="${workpermit.permitId}">P250101001</div></div>
                  <div class="stack col-span-9"><div class="label">작업명</div><div th:text="${workpermit.name}">배관 용접 작업</div></div>
                  <div class="stack col-span-3"><div class="label">설비 번호</div><div th:text="${workpermit.plantId}">EQP000123</div></div>
                  <div class="stack col-span-3"><div class="label">허가유형</div><div th:text="${workpermit.jobId}">HOT</div></div>
                  <div class="stack col-span-3"><div class="label">Site</div><div th:text="${workpermit.siteId}">SEOUL</div></div>
                  <div class="stack col-span-3"><div class="label">관리부서</div><div th:text="${workpermit.deptId}">설비팀</div></div>
                </div>
              </div>

              <div class="section">
                <div class="section-title">일정 / 담당</div>
                <div class="grid cols-12">
                  <div class="stack col-span-3"><div class="label">담당자</div><div th:text="${workpermit.memberId}">M0001</div></div>
                  <div class="stack col-span-3"><div class="label">계획일</div><div th:text="${workpermit.plannedDate}">2025-01-12</div></div>
                  <div class="stack col-span-3"><div class="label">실적일</div><div th:text="${workpermit.actualDate}">2025-01-12</div></div>
                  <div class="stack col-span-3"><div class="label">상태</div><div><span class="badge" th:text="${workpermit.status == 'REQ' ? '요청' : workpermit.status == 'APRV' ? '승인' : workpermit.status == 'REJT' ? '반려' : '종료'}" 
                            th:classappend="${workpermit.status == 'REQ' ? 'badge' : workpermit.status == 'APRV' ? 'badge success' : workpermit.status == 'REJT' ? 'badge danger' : 'badge success'}">요청</span></div></div>
                </div>
              </div>

              <div class="section">
                <div class="section-title">작업 개요 / 안전</div>
                <div class="grid cols-12">
                  <div class="stack col-span-12"><div class="label">작업 개요</div><div th:text="${workpermit.workSummary}">배관 용접 및 누설 확인</div></div>
                  <div class="stack col-span-6"><div class="label">위험 요인</div><div th:text="${workpermit.hazardFactor}">화재, 화상, 유해가스</div></div>
                  <div class="stack col-span-6"><div class="label">안전 조치</div><div th:text="${workpermit.safetyFactor}">가연물 제거, 소화기 비치, 산소농도 측정</div></div>
                </div>
              </div>

              <div class="section">
                <div class="section-title">체크리스트(JSON)</div>
                <pre class="note" style="white-space:pre-wrap" th:text="${workpermit.checksheetJson}">[{"item":"산소농도 측정","result":"OK"}]</pre>
              </div>

              <div class="section">
                <div class="section-title">첨부</div>
                <div data-file-list 
                     th:if="${workpermit.fileGroupId}"
                     th:attr="data-file-group-id=${workpermit.fileGroupId}"
                     data-empty-text="첨부된 파일이 없습니다."
                     data-loading-text="첨부 파일을 불러오는 중..."
                     data-error-text="첨부 파일을 불러올 수 없습니다.">
                </div>
                <div th:unless="${workpermit.fileGroupId}" class="notice">
                  첨부된 파일이 없습니다.
                </div>
              </div>

              <!-- 출력 문서 형식 -->
              <div class="section">
                <div class="section-title">서명</div>
                <div th:if="${items != null and !items.empty}">
                  <div class="grid cols-12" th:each="it, iter : ${items}">
                    <div class="stack col-span-3"><div class="label">순번</div><div th:text="${iter.index + 1}">1</div></div>
                    <div class="stack col-span-3"><div class="label">이름</div><div th:text="${it.name}">홍길동</div></div>
                    <div class="stack col-span-6">
                      <div class="label">서명</div>
                      <div>
                        <img th:if="${it.signature}" th:src="${it.signature}" alt="서명" style="max-width:360px;max-height:120px;border:1px solid var(--border);background:#fff" />
                        <span class="muted" th:if="${it.signature == null}">-</span>
                      </div>
                    </div>
                  </div>
                  <div class="section" style="margin-top:8px">
                    <div style="font-weight:700;margin-bottom:4px">서명</div>
                    <table class="table">
                      <thead>
                        <tr>
                          <th style="width:60px">#</th>
                          <th style="width:200px">이름</th>
                          <th>서명</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr th:each="it, iter : ${items}" th:if="${items != null and !items.empty}">
                          <td th:text="${iter.index + 1}">1</td>
                          <td th:text="${it.name}">-</td>
                          <td>
                            <img th:if="${it.signature}" th:src="${it.signature}" alt="서명" style="max-height:100px" />
                            <span th:if="${it.signature == null}">-</span>
                          </td>
                        </tr>
                        <tr th:if="${items == null or items.empty}"><td colspan="3" class="muted">서명 정보가 없습니다.</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div th:if="${items == null or items.empty}" class="notice">서명 정보가 없습니다.</div>
              </div>

              <section class="print-form" aria-hidden="true">
                <div class="doc">
                  <header class="doc-header">
                    <div class="doc-title">작업허가서</div>
                    <div class="doc-meta">
                      <div class="meta-row">출력일시: <span id="print-date">-</span></div>
                      <div class="meta-row">인쇄자: <span id="print-user">-</span></div>
                    </div>
                  </header>
                  <div class="doc-body">
                    <div class="row"><strong>허가 번호</strong><span class="spacer"></span><span th:text="${workpermit.permitId}">P250101001</span></div>
                    <div class="row"><strong>작업명</strong><span class="spacer"></span><span th:text="${workpermit.name}">배관 용접 작업</span></div>
                    <div class="row"><strong>설비 번호</strong><span class="spacer"></span><span th:text="${workpermit.plantId}">EQP000123</span></div>
                    <div class="row"><strong>허가유형</strong><span class="spacer"></span><span th:text="${workpermit.jobId}">HOT</span></div>
                    <div class="row"><strong>계획일</strong><span class="spacer"></span><span th:text="${workpermit.plannedDate}">2025-01-12</span></div>
                    <div class="row"><strong>실적일</strong><span class="spacer"></span><span th:text="${workpermit.actualDate}">2025-01-12</span></div>
                    <div class="row"><strong>상태</strong><span class="spacer"></span><span th:text="${workpermit.status == 'REQ' ? '요청' : workpermit.status == 'APRV' ? '승인' : workpermit.status == 'REJT' ? '반려' : '종료'}">요청</span></div>
                  </div>
                </div>
              </section>
            </div>
          </section>
        </div>
        </main>
      </section>
      <footer>
        <div class="container">© 작업관리</div>
      </footer>
    </div>
    
    <!-- 인라인 스크립트 제거됨 - workpermit.js로 이관 -->
  </body>
  </html>
