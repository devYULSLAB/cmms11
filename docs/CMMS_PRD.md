# CMMS 제품 사양서(PRD)

> 대상: **플랜트 내부 사용자**(관리자/점검자/정비자). 외부 사용자는 별도 시스템 고려.

## 1. 목적/배경
- **안정성**: 센서 연동이 제한적이므로, 과거 이력/통계 기반 경향 파악과 임계값 경고(수동 기준)를 통해 설비를 **안정적으로 운영**.
- **효율성**: 비용·인력 사용 최적화(작업 배치, 부품 재고의 적정 수준 유지)로 **유지보수 효율** 극대화.
- **편의성**: 모바일/태블릿 대응, 엑셀 업로드/다운로드, 출력 문서 템플릿, 결재(승인) 흐름 제공.
- **일관성**: 화면(Form/List/Detail)과 데이터 규격, 파일 업로드 모듈을 **재사용 가능한 컴포넌트**로 표준화.

## 2. 범위(Scope)
- **도메인**: company, site, user, function(기능위치:설비 마스터의 분류), storage(창고),role, user-role mapping
- **공통코드**: code_type(작업유형,자산유형,감가유형,허가유형...), code_item(작업유형:예방/돌발/오더/검교정,설비유형:설비/재고/부외-소모품/부외-사무,감가유형:정액/정률,허가유형:화기/밀폐/고소/감전)
- **마스터**: plantMaster(설비), inventoryMaster(재고) — 대량 입력을 위한 엑셀 I/O.
- **트랜잭션**: inspection(예방점검), workOrder(작업지시), workpermit(작업허가).
- **공통**: 파일 업로드/다운로드, 결재모듈(문서 작성·상신·승인), 대시보드

## 3. 주요 기능(요구사항)
- 모든 database table에는 회사코드가 첫번째 KEY로 포함 
- 생성/수정, 조회(출력 폼 제공), 리스트(다운로드) 제공 
### 3.1 설비/재고
- 마스터 데이터는 생성일, 생성자, 수정일, 수정자, 삭제마크(실제 데이터 삭제하지 않고 마크 표시 )
- 설비 등록/수정,조회,목록
 : 기본정보{설비 번호, 이름, 자산유형, 사이트번호(재고마스터는 없고 설비마스터만 있음:재고는 창고별 이동하며 사이트와 별도 개념으로 설계) 관리부서, 기능위치 }, 제조사정보{제조사,모델번호,시리얼번호,스펙}, 재무정보{설치일, 감가유형, 감가기간,취득가, 잔존가 }, 운영플래그{예방점검대상,PSM대상, 작업허가대상}, 점검정보{주기, 마지막 점검일, 다음 점검일}, 상태(승인,임시시), 비고(notes), 파일첨부
- 재고 등록/수정,조회,목록
  : 기본정보{재고 번호, 이름, 자산유형, 관리부서} 제조사정보(동일), "재무정보 없음-재고는 입고 출고와 같은 트랜젹션에 따라 별도 운영", "운영플래그 없음", "점검정보 없음", 상태, 비고, 파일첨부 

### 3.1.1 재고 처리 
- 재고 입고, 출고, 이동, 조정 
- 재고 처리에 대해 히스토리를 관리하고 재고 금액과 수량 테이블 별도로 관리하고 월단위 마감하여 창고별 재고 수량과 금액에 대한 수불관리 레포트 지원 
 : 재고는 평균법 사용 - 입고 시 금액과 수량을 합산하고 평균값이 현 재고 단가, 출고는 재고 단가와 수량의 곱함, 창고간 이동은 출고-입고 처리, 조정은 그대로 재고 금액과 수량을 조정함. 창고는 site와 키 값 관계가 아니고 한 회사 밑에 독립적인 단위이며, 창고 단위로 단가 관리함 
 : 수불정보는 기초 금액과 기간에 대한 입고/출고/이동/조정 및 기말 재고와 금액 보고 

### 3.2 예방점검(Inspection)
- 기본정보{계회 번호, 내용, 설비 번호, 작업유형, 사이트번호}, 작업정보{담당부서, 담당자, 예정수행일, 실 수행일}, 상태, 비고, 파일첨부 
- 다중 작업항목(항목,방법, 단위, 점검기준-최소/최대/표준, 점검값, 비고)
- 과거 점검항목 복사 기능(반복작업 입력 감소 목적)
- 결과 확정 후 수정 불가(관리자 예외)
- 결과 확정 후 설비 마스터의 마지막 점검일에 기록하고 다음 점검일도 기록하여 점검 예정목록 조회 시 조회되도록 함 

### 3.3 작업지시(WorkOrder)
- 기본정보{작업 번호, 작업 내용, 설비 번호, 작업유형, 사이트번호}, 작업정보{담당부서, 담당자, 예정수행일, 예정비용, 예정시간, 실 수행일, 수행비용, 수행시간},상태, 비고,파일첨부
- 다중 작업항목 (작업이름, 방법, 결과값, 비고)

### 3.4 작업허가(Workpermit)
- 체크시트 템플릿/결과(회사 단위), 담당자 이름 + 싸인 기능 제공
- 체크시트는 기존 문서을 스캔한 파일을 템플릿화 하여 이미지에 직접 수기로 체크하도록 하고 이미지 저장, 웹에서 체크시트 구현하지 말 것 

### 3.5 파일 업로드(공통 컴포넌트)
- **독립 모듈화**: 단독 페이지/테스트 가능, 폼과 분리된 REST API와 JS 위젯.
- 검증: 허용 확장자/용량/개수, 바이러스 스캔(옵션), 업로드 실패/재시도/취소.
- 저장: fileGroupId 기준 그룹화, 원본명/서명/크기/해시/경로 저장.
- 보안: 권한 기반 접근, 서명 URL(권한 체크), 감사로그.

### 3.6 결재(승인) 모듈
- 트랜잭션(점검/작업/허가) 참조하여 결재문 생성, 단계 별 승인 플로우, 반려/재상신.
- 에디터: 표/서식/서명 이미지, 히스토리, 출력.

### 3.7 대시보드/모바일
- 대시보드: 이번 주 일정, 지연, 재고 위험, 작업현황 KPI.
- 모바일 대응: 태블릿/폰 입력 최적화(그리드→스택), 오프라인 초안(선택).

### 3.8 출력/엑셀
- 출력 템플릿(회사 로고/헤더/푸터), 한글 폰트 대응.
- 엑셀 업/다운로드 — 컬럼 매핑 유틸, 유효성 검증 리포트.

### 3.9 게시판 
- 정보를 공유할 수 있는 게시판과 댓글 기능 
- 파일 첨부 제공 

## 4. 비기능 요구사항(NFR)
- **일관성**: 필드명/코드/메시지키 일치, ERD-화면 매핑 문서화.
- **성능**: 목록 페이지 첫 페이지 렌더 1.5s 이내(300행 페이징), 업로드(20MB 단건 3s 내).
- **보안**: RBAC, 감사로그, 파일 접근 제어, XSS/CSRF 방어.
- **가용성**: 장애 로그/알림, 백업/복구 가이드.
- **국제화**: 한/영 메시지 번들.
- **브라우저**: 최신 크롬/엣지, 모바일 크롬.

## 5. 정보 구조 및 화면 표준
- **Form/List/Detail 레이아웃 가이드**: 컴팩트 여백(8–12px), 라운드 최소화, 단색 중립 팔레트.
- **입력 컴포넌트 표준**: label 12–13px, 입력 높이 32–36px, 에러/헬프 텍스트 규칙.
- **그리드 규칙**: col 12 기반, md~lg에서 2–3열 전환.

## 6. 데이터 모델(요약)
- ID 규칙: 코어 ID 10자리, 사용자/부서/회사/사이트 5자리, itemId 2자리 자동.
- 공통 감사필드: createDate/by, updateDate/by.
- 코드: jobType 등 5자 코드(시스템 설정).

## 7. 통합/아키텍처
- 레이어드 아키텍처(Controller/Service/Repository), 공통 모듈 분리(파일: `cmms4/common/file`), 메시지/코드/로그 공통화.
- 환경 분리(dev/prod), 설정은 `application.yml` 관리.

## 8. 수용 기준(Acceptance Criteria) — 샘플
- [ ] 파일 업로드 위젯 단독 페이지에서 허용 확장자/용량 검증 및 에러 메시지 동작.
- [ ] Inspection 결과 **임시저장/확정** 동작 및 확정 후 수정 제한 확인(관리자 예외 확인).
- [ ] 엑셀 업로드 시 컬럼 매핑 사전/사후 검증 리포트 제공.
- [ ] 대시보드에서 이번 주 미실시 점검 건수와 위험 재고 카드 노출.

## 9. 마일스톤
- M1: UI 고정(폼/리스트/상세, 파일 업로드 단독 페이지)  
- M2: Inspection/WorkOrder API·로직  
- M3: 결재/출력/엑셀  
- M4: 대시보드/모바일 최적화 & 하드닝

---

# Task 리스트(초안)

## A. UI
- [ ] form.html 확정(필드/여백/반응형)
- [ ] list.html 확정(검색/페이징/정렬)
- [ ] detail.html 확정(출력/인쇄 레이아웃)
- [ ] 파일 업로드 **단독 테스트 페이지** 구현(통합 전)

## B. 공통 모듈
- [ ] 파일 업로드 API(검증·저장·권한) + JS 위젯
- [ ] 메시지 번들(한/영), 공통 코드 로더
- [ ] 감사로그 인터셉터

## C. 트랜잭션
- [ ] Inspection 계획/항목/결과 API 및 화면 연동
- [ ] WorkOrder 생성/배정/자재차감 연동
- [ ] Workpermit 체크시트 템플릿/결과 & 결재 연동

## D. 편의 기능
- [ ] 엑셀 업/다운로드(마스터/결과)
- [ ] 출력 템플릿(회사 로고/헤더/푸터)
- [ ] 대시보드(KPI/알림)

## E. 테스트/릴리즈
- [ ] 수용 기준 기반 E2E 체크리스트 실행
- [ ] 성능 프로파일링(목록/업로드)
- [ ] 보안 점검(XSS/CSRF/권한)
