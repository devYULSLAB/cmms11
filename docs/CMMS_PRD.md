# CMMS 제품 사양서(PRD)

> **대상 사용자**: 시스템 기획자  
> **최종 사용자**: 플랜트 내부 사용자 (관리자/점검자/정비자)

## 1. 제품 개요

### 1.1 목적 및 비전
- **안정성**: 과거 이력/통계 기반 경향 파악과 임계값 경고를 통한 설비 안정 운영
- **효율성**: 비용·인력 사용 최적화로 유지보수 효율 극대화
- **편의성**: 모바일/태블릿 대응, 엑셀 I/O, 출력 템플릿, 결재 흐름 제공
- **일관성**: 재사용 가능한 컴포넌트 기반 표준화된 UI/UX

### 1.2 핵심 가치 제안
- **통합 관리**: 설비, 재고, 점검, 작업을 하나의 시스템에서 통합 관리
- **프로세스 자동화**: 결재, 알림, 일정 관리 자동화로 업무 효율성 향상
- **데이터 기반 의사결정**: 이력 데이터 분석을 통한 예방적 유지보수 지원
- **모바일 최적화**: 현장 작업자를 위한 모바일/태블릿 친화적 인터페이스

### 1.3 핵심 KPI (Key Performance Indicators)
| KPI 영역 | 지표명 | 측정 방법 | 목표값 | 비즈니스 임팩트 |
|----------|--------|-----------|--------|-----------------|
| **안정성** | 설비 가동률 | (총 가동시간 - 장애시간) / 총 가동시간 × 100 | ≥95% | 생산성 향상, 손실 최소화 |
| | 예방점검 준수율 | 실제 점검 건수 / 계획 점검 건수 × 100 | ≥90% | 예방적 유지보수 강화 |
| | 응급작업 비율 | 응급작업 건수 / 총 작업 건수 × 100 | ≤20% | 계획적 유지보수 확대 |
| **효율성** | 평균 수리시간(MTTR) | 총 수리시간 / 수리 건수 | ≤4시간 | 장애 복구 시간 단축 |
| | 평균 고장간격(MTBF) | 총 가동시간 / 고장 건수 | ≥720시간 | 설비 신뢰성 향상 |
| | 재고 회전율 | 연간 출고비용 / 평균재고비용 | ≥6회 | 재고 효율성 증대 |
| **비용** | 유지보수비 대비 효과 | 절감비용 / 유지보수비 × 100 | ≥150% | 투자 대비 효과 극대화 |
| | 예방비용 대비 응급비용 | 예방비용 / 응급수리비용 | ≤0.5 | 예방적 접근의 경제성 |
| **품질** | 재작업률 | 재작업 건수 / 총 작업 건수 × 100 | ≤5% | 작업 품질 향상 |
| | 안전사고 건수 | 월간 안전사고 발생 건수 | 0건 | 작업 안전성 확보 |
| **사용성** | 시스템 사용률 | 일일 활성 사용자 / 등록 사용자 × 100 | ≥80% | 시스템 도입 효과 |
| | 작업 완료율 | 완료된 작업 / 할당된 작업 × 100 | ≥95% | 업무 효율성 증대 |

## 2. 기능 범위

### 2.1 핵심 도메인
| 도메인 | 설명 | 주요 기능 |
|--------|------|-----------|
| **기준정보** | 회사, 사이트, 부서, 사용자, 역할 관리 | 조직도 관리, 권한 설정 |
| **설비관리** | 설비 마스터, 기능위치, 자산 정보 | 설비 등록/수정, 자산 추적 |
| **재고관리** | 재고 마스터, 창고, 수불 관리 | 입출고, 이동, 조정, 재고 현황 |
| **예방점검** | 점검 계획, 실행, 결과 관리 | 점검 일정, 항목 관리, 결과 기록 |
| **작업관리** | 작업지시, 작업허가, 진행 추적 | 작업 계획, 실행, 완료 처리 |
| **결재** | 문서 작성, 상신, 승인 프로세스 | 다단계 승인, 반려, 이력 관리 |
| **게시판** | 정보 공유, 파일 첨부, 댓글 | 커뮤니케이션, 지식 공유 |

### 2.2 지원 기능
- **파일 관리**: 업로드/다운로드, 버전 관리, 권한 기반 접근 제어
- **엑셀 I/O**: 대량 데이터 처리, 템플릿 기반 업로드/다운로드
- **출력/보고서**: 표준 문서 템플릿, PDF 출력, 차트/그래프
- **대시보드**: KPI 모니터링, 알림, 현황 요약

### 2.3 핵심 KPI 구현 매핑

#### 2.3.1 안정성 KPI 구현
| KPI | 구현 기능 | 데이터 소스 | 계산 로직 |
|-----|-----------|-------------|-----------|
| **설비 가동률** | 대시보드, 설비 모니터링 | PLANT(설비정보), WORKORDER(작업이력) | (총 가동시간 - 장애시간) / 총 가동시간 × 100 |
| **예방점검 준수율** | 점검 일정 관리, 완료 추적 | INSPECTION(점검계획), INSPECTION_RESULT(점검결과) | 실제 점검 건수 / 계획 점검 건수 × 100 |
| **응급작업 비율** | 작업 유형 분류, 통계 | WORKORDER(작업유형, 발생일시) | 응급작업 건수 / 총 작업 건수 × 100 |

#### 2.3.2 효율성 KPI 구현
| KPI | 구현 기능 | 데이터 소스 | 계산 로직 |
|-----|-----------|-------------|-----------|
| **평균 수리시간(MTTR)** | 작업 완료 시간 추적 | WORKORDER(시작일시, 완료일시, 작업유형) | 총 수리시간 / 수리 건수 |
| **평균 고장간격(MTBF)** | 설비 장애 간격 분석 | PLANT(설비정보), WORKORDER(장애작업) | 총 가동시간 / 고장 건수 |
| **재고 회전율** | 재고 수불 분석 | INVENTORY_HISTORY(입출고), INVENTORY_STOCK(현재재고) | 연간 출고비용 / 평균재고비용 |

#### 2.3.3 비용 KPI 구현
| KPI | 구현 기능 | 데이터 소스 | 계산 로직 |
|-----|-----------|-------------|-----------|
| **유지보수비 대비 효과** | 비용 대비 절감 효과 분석 | WORKORDER(실제비용), PLANT(자산가치) | 절감비용 / 유지보수비 × 100 |
| **예방비용 대비 응급비용** | 작업 유형별 비용 비교 | WORKORDER(작업유형, 실제비용) | 예방비용 / 응급수리비용 |

#### 2.3.4 품질 KPI 구현
| KPI | 구현 기능 | 데이터 소스 | 계산 로직 |
|-----|-----------|-------------|-----------|
| **재작업률** | 작업 상태 추적 | WORKORDER(작업상태, 재작업여부) | 재작업 건수 / 총 작업 건수 × 100 |
| **안전사고 건수** | 안전사고 등록 및 추적 | WORKPERMIT(안전사고여부), MEMO(사고보고) | 월간 안전사고 발생 건수 |

#### 2.3.5 사용성 KPI 구현
| KPI | 구현 기능 | 데이터 소스 | 계산 로직 |
|-----|-----------|-------------|-----------|
| **시스템 사용률** | 사용자 활동 추적 | 사용자 로그인 이력, 활동 로그 | 일일 활성 사용자 / 등록 사용자 × 100 |
| **작업 완료율** | 작업 진행 상황 모니터링 | WORKORDER(작업상태, 담당자) | 완료된 작업 / 할당된 작업 × 100 |

## 3. 권한 관리 (RBAC/CRUD 매트릭스)

### 3.1 사용자 역할 정의
| 역할 | 설명 | 주요 권한 |
|------|------|-----------|
| **ADMIN** | 시스템 관리자 | 기준정보 CRUD, 모든 메모/결재/트랜잭션 CRUD |
| **MANAGER** | 관리자 | 트랜잭션 CRUD, 기준정보 조회 |
| **TECHNICIAN** | 기술자 | 점검/작업 관련 미확정 전까지 CRUD |
| **VIEWER** | 조회자 | 모든 모듈 Read 권한만 |

### 3.2 권한 체계 정의

#### 3.2.1 권한 명명 규칙
```
[모듈명]_[ROLE]_{C|R|U|D}
```

**모듈 분류**:
- **기준정보**: COMPANY, SITE, DEPT, USER, ROLE, CODE
- **마스터**: PLANT, INVENTORY, STOCK, STORAGE
- **트랜잭션**: INSPECTION, WORKORDER, WORKPERMIT, INSPECTION_RESULT
- **문서**: MEMO, APPROVAL, BOARD
- **시스템**: DASHBOARD, REPORT, SYSTEM

#### 3.2.2 역할별 권한 매트릭스
| 권한 | ADMIN | MANAGER | TECHNICIAN | VIEWER |
|------|-------|---------|------------|--------|
| **C (Create)** | 모든 모듈 | 트랜잭션 + 문서 | INSPECTION, WORKORDER, WORKPERMIT (미확정) | - |
| **R (Read)** | 모든 모듈 | 모든 모듈 | 모든 모듈 | 모든 모듈 |
| **U (Update)** | 모든 모듈 | 트랜잭션 + 문서 | INSPECTION, WORKORDER, WORKPERMIT (미확정) | - |
| **D (Delete)** | 모든 모듈 | 문서만 | - | - |

#### 3.2.3 세부 권한 목록

### 3.3 특별 권한 규칙
- **확정 후 수정**: 점검 결과 확정 후 일반 사용자는 수정 불가, ADMIN만 수정 가능
- **부서별 접근**: 자신의 담당 부서 데이터 우선 표시, MANAGER 이상은 해당 사이트 내에서 전체 조회 가능
- **사이트별 접근**: 사용자의 기본 사이트 기반 필터링
- **파일 접근**: 업로드한 사용자와 승인된 사용자만 접근 가능

## 4. 상세 기능 요구사항

### 4.1 설비 및 재고 관리
#### 4.1.1 설비 마스터
- 설비의 기본정보, 제조사정보, 재무정보, 운영플래그(점검/PSM/작업허가 대상 여부) 관리
- 점검주기 관리 및 다음점검일 자동 계산
- 설비번호는 회사별 고유성 보장

#### 4.1.2 재고 마스터 및 수불
- 재고 품목의 기본정보 및 Storage Level 단위 관리
- **재고 평가방법**: 평균법 (입고 시 평균단가 재계산, 출고 시 현재 단가 적용)
- **수불 처리**: 입고/출고/이동(출고-입고 연동)/조정
- **월마감**: 기초/입고/출고/이동/조정/기말 재고 및 금액 보고

### 4.2 예방점검 관리
- 점검 계획 수립, 실행, 결과 관리
- 다중 작업항목 관리 (점검기준: 최소/최대/표준값, 실제 점검값 기록)
- **과거 항목 복사 기능**: 반복 작업 입력 감소
- **결과 확정 후 수정 불가** (ADMIN 권한 예외)
- 점검 완료 시 설비 마스터의 마지막점검일/다음점검일 자동 업데이트

### 4.3 작업 관리
#### 4.3.1 작업지시
- 설비 정비 작업의 지시, 실행, 완료 처리
- 계획(예정일/비용/시간) 및 실적(실수행일/비용/시간) 관리
- 다중 작업항목 및 결과값 기록

#### 4.3.2 작업허가
- 위험작업에 대한 허가 및 안전 체크시트 관리
- 체크시트 이미지 템플릿 활용 (스캔 문서 기반)
- 담당자 서명 이미지 저장

### 4.4 결재 및 문서 관리
#### 4.4.1 결재 프로세스
**기능 목적**: 문서의 작성, 상신, 승인, 반려 프로세스 관리 및 원본 모듈과의 상태 동기화

**주요 요구사항**:
- 트랜잭션 데이터 기반 결재문 자동 생성
- 다단계 승인 플로우 지원 (DRAFT → SUBMIT → PROC → APPROV)
- 반려/재상신 처리 (REJECT → 원본 모듈 DRAFT 복원)
- 결재 이력 및 상태 추적
- 결재문 에디터: 표, 서식, 서명 이미지 지원

**결재 연동 아키텍처**:

1. **결재 요청 프로세스**
   ```
   업무 모듈 (Inspection/WorkOrder/WorkPermit)
     ↓ [결재 상신] 버튼 클릭 (detail.html)
     ↓ submitApproval(id, stage, module) 호출
   Approval 생성 (status=DRAFT, refEntity, refId, refStage)
     ↓ 원본 모듈 status → *_SUBMIT (수정 차단)
   approval/form.html 
     ↓ 결재선 입력 + [상신] 버튼
   Approval.status: DRAFT → SUBMIT
     ↓ 결재자 승인/반려 대기
   ```

2. **결재 완료 콜백 메커니즘**
   - **승인 시 (APPROV)**:
     - `ApprovalService.approve()` → `notifyRefModule(approval, "APPROV")`
     - 원본 모듈의 `onPlanApprovalApprove()` 또는 `onActualApprovalApprove()` 호출
     - 원본 모듈 status → *_APPROV
   
   - **반려 시 (REJECT)**:
     - `ApprovalService.reject()` → `notifyRefModule(approval, "REJECT")`
     - 원본 모듈의 `onPlanApprovalReject()` 또는 `onActualApprovalReject()` 호출
     - 원본 모듈 status → *_DRAFT (수정 후 재상신 가능)
   
   - **삭제 시 (DRAFT 상태만)**:
     - `ApprovalService.delete()` → `notifyRefModule(approval, "DELETE")`
     - 원본 모듈의 `onPlanApprovalDelete()` 또는 `onActualApprovalDelete()` 호출
     - 원본 모듈 status → *_DRAFT, approvalId → null

3. **모듈별 결재 단계 (refStage)**
   
   | 모듈 | 결재 단계 | refStage 값 | 설명 |
   |------|----------|-------------|------|
   | **Inspection** | 실적만 | `"ACT"` | 계획은 자동 확정, 실적만 결재 |
   | **WorkOrder** | 계획 + 실적 | `"PLN"`, `"ACT"` | 2단계 결재 (계획 승인 → 실적 입력 → 실적 승인) |
   | **WorkPermit** | 계획만 | `null` | 단일 결재 (계획 승인으로 완료) |

4. **콜백 메서드 표준 인터페이스**
   
   모든 업무 모듈 Service는 다음 메서드를 구현:
   
   ```java
   // 계획 단계 콜백
   public ApprovalResponse submitPlanApproval(String entityId);
   public void onPlanApprovalApprove(String entityId);
   public void onPlanApprovalReject(String entityId);
   public void onPlanApprovalDelete(String entityId);
   
   // 실적 단계 콜백 (Inspection, WorkOrder만)
   public ApprovalResponse submitActualApproval(String entityId);
   public void onActualApprovalApprove(String entityId);
   public void onActualApprovalReject(String entityId);
   public void onActualApprovalDelete(String entityId);
   
   // 결재 본문 생성
   private String buildPlanApprovalContent(Entity entity);
   private String buildActualApprovalContent(Entity entity);
   ```

5. **상태 전환 규칙**
   
   - **Inspection**: PLN_APPROV (자동) → [실적 입력] → ACT_DRAFT → ACT_SUBMIT → ACT_APPROV
   - **WorkOrder**: PLN_DRAFT → PLN_SUBMIT → PLN_APPROV → [실적 입력] → ACT_DRAFT → ACT_SUBMIT → ACT_APPROV
   - **WorkPermit**: PLN_DRAFT → PLN_SUBMIT → PLN_APPROV (최종 완료)
   
   - **반려 처리**: *_SUBMIT → REJECT → *_DRAFT (수정 후 재상신 가능)
   - **삭제 처리**: DRAFT 상태만 삭제 가능, 삭제 시 원본 모듈 복원

**비즈니스 규칙**:
- 결재 진행 중(*_SUBMIT, *_PROC) 또는 승인 완료(*_APPROV) 상태에서는 원본 문서 수정/삭제 불가
- 반려(REJECT)된 문서는 *_DRAFT로 복원되어 수정 후 재상신 가능
- Approval 모듈은 단방향으로 업무 모듈을 참조 (ApprovalService만 업무 Service 주입)
- 결재 완료 시 콜백으로 원본 모듈 상태 자동 업데이트

#### 4.4.2 메모/게시판
- 정보 공유 및 커뮤니케이션 (파일 첨부, 댓글 지원)
- 권한 제어: 본인만 수정/삭제 가능 (ADMIN은 전체 가능)

### 4.5 공통 컴포넌트
#### 4.5.1 파일 관리
- **파일 그룹화**: fileGroupId(10자리) 기준 그룹 관리
- **검증**: 허용 확장자/용량 제한, SHA256 체크섬
- **보안**: 권한 기반 접근, 업로드자와 승인된 사용자만 접근

#### 4.5.2 출력 및 엑셀 I/O
- 회사 로고/헤더/푸터 포함 PDF 출력
- 엑셀 업로드/다운로드 (컬럼 매핑, 유효성 검증)

### 4.6 대시보드
- **실시간 모니터링**: 이번 주 점검/작업 일정, 지연 작업 현황
- **알림**: 재고 위험, 점검 예정, 작업 지연 알림
- **KPI**: 설비 가동률, 예방점검 준수율, MTTR/MTBF, 재고 회전율
- **트렌드 분석**: 월별/분기별 성과 추이, 예외 상황 패턴
- **역할별 맞춤 대시보드**

### 4.7 모바일 지원
- 태블릿/스마트폰 반응형 레이아웃
- 터치 친화적 UI (44px 최소 터치 영역)
- 오프라인 초안 저장 (선택사항) 

## 5. 비기능 요구사항

### 5.1 성능 요구사항
| 항목 | 요구사항 | 측정 기준 |
|------|----------|-----------|
| **응답시간** | 목록 페이지 첫 페이지 렌더링 | 1.5초 이내 (300행 페이징) |
| **파일업로드** | 단일 파일 업로드 | 20MB 파일 3초 이내 |
| **데이터베이스** | 복잡한 조회 쿼리 | 2초 이내 |
| **동시사용자** | 시스템 동시 접속 | 100명 이상 지원 |

### 5.2 보안 요구사항
| 항목 | 요구사항 | 구현 방식 |
|------|----------|-----------|
| **인증/인가** | RBAC 기반 권한 관리 | Spring Security + 커스텀 권한 |
| **데이터보호** | 개인정보 및 민감정보 보호 | 암호화, 접근 로그 |
| **파일보안** | 파일 업로드/다운로드 보안 | 바이러스 스캔, 확장자 제한 |
| **웹보안** | XSS/CSRF 공격 방어 | Spring Security 설정 |
| **감사로그** | 모든 중요 작업 로그 기록 | 접근, 수정, 삭제 이력 추적 |

### 5.3 가용성 요구사항
| 항목 | 요구사항 | 구현 방안 |
|------|----------|-----------|
| **시스템가용성** | 99.5% 이상 업타임 | 모니터링, 자동 복구 |
| **데이터백업** | 일일 백업 및 복구 | 자동 백업 스케줄 |
| **장애대응** | 장애 발생 시 알림 | 로그 모니터링, 알림 시스템 |

### 5.4 사용성 요구사항
| 항목 | 요구사항 | 구현 방식 |
|------|----------|-----------|
| **브라우저지원** | 최신 크롬/엣지, 모바일 크롬 | 반응형 웹 디자인 |
| **국제화** | 한국어/영어 지원 | 메시지 번들 관리 |
| **접근성** | 장애인 접근성 고려 | WCAG 2.1 AA 수준 |

## 6. 수용 기준 (Acceptance Criteria)

### 6.1 핵심 기능 수용 기준
| 기능 | 수용 기준 |
|------|-----------|
| **파일업로드** | [ ] 허용 확장자/용량 검증 및 에러 메시지 표시<br>[ ] 업로드 실패 시 재시도 기능<br>[ ] 권한 기반 파일 접근 제어 |
| **예방점검** | [ ] 점검 결과 임시저장/확정 기능<br>[ ] 확정 후 수정 제한 (ADMIN 예외)<br>[ ] 설비 마스터 점검일 자동 업데이트 |
| **재고관리** | [ ] 평균법 기반 단가 계산<br>[ ] 창고간 이동 시 출고-입고 연동<br>[ ] 월마감 처리 및 수불보고서 생성 |
| **결재프로세스** | [ ] 다단계 승인 플로우<br>[ ] 반려/재상신 처리<br>[ ] 결재 이력 추적 |
| **대시보드** | [ ] 이번 주 미실시 점검 건수 표시<br>[ ] 위험 재고 알림 카드<br>[ ] 작업현황 KPI 대시보드 |

### 6.2 데이터 처리 수용 기준
| 항목 | 수용 기준 |
|------|-----------|
| **엑셀I/O** | [ ] 컬럼 매핑 사전/사후 검증<br>[ ] CSV 포맷 검증 리포트 제공<br>[ ] 대량 데이터 업로드 처리 |
| **보고서** | [ ] 회사 로고/헤더/푸터 포함<br>[ ] 한글 폰트 정상 출력<br>[ ] PDF 출력 기능 |

## 7. 참조 문서

### 7.1 기술 문서
- **[CMMS_TABLES.md](./CMMS_TABLES.md)**: 데이터 모델 상세 설계 및 테이블 구조
- **[CMMS_STRUCTURES.md](./CMMS_STRUCTURES.md)**: 기술 아키텍처 및 구현 가이드
- **[PRODUCTION_CHECKLIST.md](./PRODUCTION_CHECKLIST.md)**: 운영 배포 체크리스트

### 7.2 관련 문서
- **[CMMS_mobile.md](./CMMS_mobile.md)**: 모바일 앱 요구사항 및 설계
- **[README.md](../README.md)**: 프로젝트 개요 및 설치 가이드
