<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CMMS · Layout</title>
    <link rel="stylesheet" href="../assets/css/base.css" />
    <style>
      html, body { height: 100%; overflow: hidden; }
      /* Layout grid to keep footer fixed at bottom and content sized */
      .layout {
        display: grid;
        grid-template-areas:
          "header header"
          "sidebar content"
          "footer footer";
        grid-template-rows: auto 1fr auto;
        grid-template-columns: 250px 1fr;
        height: 100vh; /* lock viewport height so only content scrolls */
      }
      .header { grid-area: header; }
      .sidebar { grid-area: sidebar; border-right:1px solid var(--border); padding:12px; overflow:auto; }
      .content { grid-area: content; overflow:auto; -webkit-overflow-scrolling: touch; }
      .footer { grid-area: footer; }
      /* Ensure a consistent visual height even when content is sparse */
      #layout-slot { min-height: 480px; }
      /* Sidebar menu */
      .sidemenu { display:block; }
      .menu-group { margin-bottom: 8px; border-radius: 6px; }
      .menu-title { display:flex; align-items:center; width:100%; padding:8px 10px; background: var(--bg-subtle); border:1px solid var(--border); border-radius:6px; cursor:pointer; font-weight:600; color:var(--fg); }
      .menu-title:focus { outline: 2px solid var(--focus); outline-offset: 1px; }
      .menu-items { padding:6px 8px 4px 12px; }
      .menu-group:not(.open) .menu-items { display:none; }
      .menu-item { display:block; padding:6px 4px; color: var(--fg); text-decoration: none; border-radius:4px; }
      .menu-item:hover { background: var(--bg-subtle); }
      .menu-item.active { background: var(--accent-a10); color: var(--accent-contrast); }
      @media (max-width: 860px){
        .layout {
          grid-template-areas:
            "header"
            "content"
            "footer";
          grid-template-columns: 1fr;
        }
        .sidebar { display:none; }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <header class="header appbar">
        <div class="appbar-inner">
          <div class="brand">CMMS</div>
          <div class="spacer"></div>
          <nav class="meta">
            <span id="user-info" style="margin-right:12px;color:var(--fg-muted)" 
                  th:text="${isAuthenticated ? (memberId + ':' + companyId) : '게스트 사용자'}">사용자</span>
            <a class="btn sm" th:href="@{/api/auth/logout}" href="/api/auth/logout" data-hard-nav>로그아웃</a>
          </nav>
        </div>
      </header>
      <aside class="sidebar">
        <nav class="sidemenu">
          <!-- 설비관리 -->
          <div class="menu-group open" data-group>
            <button type="button" class="menu-title" aria-expanded="true">자산관리</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/plant/form}" href="/plant/form">등록</a>
              <a class="menu-item" th:href="@{/plant/list}" href="/plant/list">목록</a>
              <a class="menu-item" th:href="@{/plant/history}" href="/plant/history">이력</a>
            </div>
          </div>

          <!-- 점검관리 -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">점검관리</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/inspection/plan}" href="/inspection/plan">계획</a>
              <a class="menu-item" th:href="@{/inspection/form}" href="/inspection/form">등록(결과)</a>
              <a class="menu-item" th:href="@{/inspection/list}" href="/inspection/list">목록</a>
            </div>
          </div>

          <!-- 작업관리 -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">작업관리</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/workorder/form}" href="/workorder/form">등록(결과)</a>
              <a class="menu-item" th:href="@{/workorder/list}" href="/workorder/list">목록</a>
            </div>
          </div>

          <!-- 작업허가 -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">작업허가</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/workpermit/form}" href="/workpermit/form">등록(결과)</a>
              <a class="menu-item" th:href="@{/workpermit/list}" href="/workpermit/list">목록</a>
            </div>
          </div>

          <!-- 재고처리  -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">재고처리</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/inventoryTx/transaction}" href="/inventoryTx/transaction">입고</a>
              <a class="menu-item" th:href="@{/inventoryTx/closing}" href="/inventoryTx/closing">마감</a>
              <a class="menu-item" th:href="@{/inventoryTx/ledger}" href="/inventoryTx/ledger">원장(레포트)</a>
            </div>
          </div>

          <!-- 결재관리 -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">결재관리</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/approval/form}" href="/approval/form">작성</a>
              <a class="menu-item" th:href="@{/approval/list}" href="/approval/list">결재함</a>
            </div>
          </div>

          <!-- 문서/게시 -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">문서/게시</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/memo/form}" href="/memo/form">작성</a>
              <a class="menu-item" th:href="@{/memo/list}" href="/memo/list">목록</a>
            </div>
          </div>

          <!-- 기본정보(도메인) -->
          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">기본정보</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/domain/company/list}" href="/domain/company/list">회사</a>
              <a class="menu-item" th:href="@{/domain/site/list}" href="/domain/site/list">사업장(사이트)</a>
              <a class="menu-item" th:href="@{/domain/dept/list}" href="/domain/dept/list">부서</a>
              <a class="menu-item" th:href="@{/domain/func/list}" href="/domain/func/list">기능위치</a>
              <a class="menu-item" th:href="@{/domain/storage/list}" href="/domain/storage/list">창고(스토리지)</a>
              <a class="menu-item" th:href="@{/domain/member/list}" href="/domain/member/list">사용자</a>
              <a class="menu-item" th:href="@{/domain/role/list}" href="/domain/role/list">권한</a>
            </div>
          </div>

          <div class="menu-group" data-group>
            <button type="button" class="menu-title" aria-expanded="false">공통코드</button>
            <div class="menu-items">
              <a class="menu-item" th:href="@{/code/types}" href="/code/types">코드 타입</a>
            </div>
          </div>
        </nav>
      </aside>
      <main class="content">
        <div class="container">
          <div id="layout-slot"></div>
        </div>
      </main>
      <footer class="footer">
        <div class="container">© CMMS</div>
      </footer>
    </div>
    <script src="../assets/js/app.js"></script>
    <script src="../assets/js/file-widget.js"></script>
    <script>
      // 네비게이션 시스템 초기화
      document.addEventListener('DOMContentLoaded', () => {
        window.cmms.navigation.init();
      });
    </script>
    
    <!-- Thymeleaf로 전달된 콘텐츠 URL을 JavaScript에서 사용할 수 있도록 설정 -->
    <script th:inline="javascript">
      // 서버에서 전달된 콘텐츠 URL을 JavaScript 변수로 설정
      window.initialContent = /*[[${content}]]*/ '/plant/list.html';
    </script>
  </body>
  </html>
