<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>게시/메모 상세 · CMMS</title>
    <!-- common CSS is loaded via layout/defaultLayout -->
    <!-- local fallback for design-only preview without server -->
    <link rel="stylesheet" href="../../static/assets/css/base.css" />
    <link rel="stylesheet" href="../../static/assets/css/print.css" />
  </head>
  <body>
    <div class="page">
      <!-- Main Content -->
      <section data-slot-root th:fragment="content" data-page="memo-detail" data-module="memo-detail">
        <main>
          <div class="container">
            <section class="card">
              <div class="card-header">
                <div class="row actions-space-between">
                  <div class="card-title">TM(Trouble Memo) 상세</div>
                  <div class="toolbar">
                    <!-- 항상 활성화 -->
                    <a class="btn" th:href="@{/memo/list}">목록</a>
                    <a class="btn" href="#" data-print-btn>인쇄</a>
                    <a class="btn primary" th:href="@{/memo/form?id={id}(id=${memo.memoId})}">수정</a>
                    
                    <!-- 작업지시 버튼: 메모에서 작업지시 생성 -->
                    <a class="btn success" 
                       th:href="@{/workorder/form(refEntity='MEMO',refId=${memo.memoId},refStage='CMPLT')}">
                      작업지시
                    </a>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="section">
                  <div class="section-title">기본정보</div>
                  <div class="grid cols-12">
                    <div class="stack col-span-6"><div class="label">제목</div><div th:text="${memo.title}">설비 점검 주기 변경 안내</div></div>
                    <div class="stack col-span-3"><div class="label">작성자</div><div th:text="${memo.createdBy}">관리자</div></div>
                    <div class="stack col-span-3"><div class="label">작성일시</div><div th:text="${#temporals.format(memo.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-05 14:30</div></div>
                  </div>
                </div>

                <div class="section">
                  <div class="section-title">내용</div>
                  <div class="doc-body" th:utext="${memo.content}">
                    <p>설비 점검 주기가 월 1회에서 2주 1회로 변경됩니다. 점검 계획은 작업관리 메뉴에서 확인 바랍니다.</p>
                  </div>
                </div>

                <div class="section">
                  <div class="section-title">첨부</div>
                  <div data-file-list 
                       th:if="${memo.fileGroupId}"
                       th:attr="data-file-group-id=${memo.fileGroupId}"
                       data-empty-text="첨부된 파일이 없습니다."
                       data-loading-text="첨부 파일을 불러오는 중..."
                       data-error-text="첨부 파일을 불러올 수 없습니다.">
                    <div class="file-list"></div>
                  </div>
                  <div th:unless="${memo.fileGroupId}" class="notice">
                    첨부된 파일이 없습니다.
                  </div>
                </div>

                <!-- 출력 문서 형식 -->
                <section class="print-form" aria-hidden="true">
                  <div class="doc">
                    <header class="doc-header">
                      <div class="doc-title">게시/메모</div>
                      <div class="doc-meta">
                        <div class="meta-row">출력일시: <span id="print-date">-</span></div>
                        <div class="meta-row">인쇄자: <span id="print-user">-</span></div>
                      </div>
                    </header>
                    
                    <div class="doc-body">
                      <div class="section">
                        <div class="section-title">기본 정보</div>
                        <table class="row-cols-4">
                          <tr>
                            <th>제목</th>
                            <td colspan="3" th:text="${memo.title}">설비 점검 주기 변경 안내</td>
                          </tr>
                          <tr>
                            <th>작성자</th>
                            <td th:text="${memo.createdBy}">관리자</td>
                            <th>작성일</th>
                            <td th:text="${#temporals.format(memo.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-05</td>
                          </tr>
                        </table>
                      </div>

                      <div class="section">
                        <div class="section-title">내용</div>
                        <div class="content-body" th:utext="${memo.content}">
                          <p>설비 점검 주기가 월 1회에서 2주 1회로 변경됩니다.</p>
                        </div>
                      </div>

                      <div class="section">
                        <div class="section-title">첨부 파일</div>
                        <div th:if="${memo.fileGroupId}" class="notice">
                          첨부 파일 있음 (파일 그룹 ID: <span th:text="${memo.fileGroupId}">-</span>)
                        </div>
                        <div th:unless="${memo.fileGroupId}" class="notice">
                          첨부된 파일이 없습니다.
                        </div>
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </section>
          </div>
        </main>
      </section>
    </div>
    
    <!-- 인라인 스크립트 제거됨 - memo.js로 이관 -->
  </body>
  </html>
