<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>설비 일괄 등록 · CMMS</title>
    <!-- common CSS is loaded via layout/defaultLayout -->
    <!-- local fallback for design-only preview without server -->
    <link rel="stylesheet" href="../../static/assets/css/base.css" />
  </head>
  <body>
    <div class="page">
      <!-- Main Content -->
      <section data-slot-root th:fragment="content" data-page="plant-upload" data-module="plant-upload">
        <main>
        <div class="container">
          <section class="card">
            <div class="card-header">
              <div class="card-title">설비 CSV 업로드</div>
              <div class="toolbar">
                <a class="btn" th:href="@{/plant/list}">목록</a>
              </div>
            </div>
            <div class="card-body">
              <div class="section">
                <div class="section-title">사용 방법</div>
                <div class="section-desc">
                  <strong>업로드 대상:</strong> 기본정보와 제조사 정보만 업로드할 수 있습니다.
                </div>
                <div class="section-desc">
                  <strong>필수 컬럼:</strong> <code>name</code> (설비명)
                </div>
                <div class="section-desc">
                  <strong>선택 컬럼:</strong> <code>plant_id</code> (비우면 자동생성), <code>asset_id</code>, <code>site_id</code>, <code>dept_id</code>, <code>func_id</code>, <code>maker_name</code>, <code>model</code>, <code>serial</code>, <code>spec</code>, <code>note</code>
                </div>
                <div class="section-desc">
                  샘플 파일을 내려받아 형식을 확인하세요:
                  <a class="btn sm" th:href="@{/assets/samples/plant-upload-sample.csv}" download>샘플 CSV 다운로드</a>
                </div>
              </div>
              <form id="uploadForm" method="post" th:action="@{/api/plants/upload}" enctype="multipart/form-data">
                <input type="hidden" name="_csrf" value="" data-csrf-field="true" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="section">
                  <div class="section-title">CSV 파일 선택</div>
                  <div class="grid cols-12">
                    <div class="col-span-6">
                      <input id="csvFile" class="input" type="file" name="file" accept=".csv,text/csv" required />
                    </div>
                    <div class="col-span-6 actions actions-left-align">
                      <button type="submit" class="btn primary">업로드 및 검증</button>
                    </div>
                  </div>
                </div>
              </form>

              <!-- 미리보기 섹션 (검증 후 표시) -->
              <div class="section" id="previewSection" hidden>
                <div class="section-title">
                  업로드 데이터 미리보기
                  <span id="previewSummary" class="badge success">(성공: 0건, 실패: 0건)</span>
                </div>
                
                <!-- 유효한 데이터 테이블 -->
                <div id="validDataSection">
                  <div class="section-desc">아래 데이터가 저장됩니다. 확인 후 [저장] 버튼을 클릭하세요.</div>
                  <table class="table">
                    <thead>
                      <tr>
                        <th style="width:120px">설비번호</th>
                        <th>설비명</th>
                        <th style="width:100px">자산유형</th>
                        <th style="width:100px">Site</th>
                        <th style="width:100px">부서</th>
                        <th style="width:100px">기능위치</th>
                        <th style="width:120px">제조사</th>
                        <th style="width:100px">모델</th>
                      </tr>
                    </thead>
                    <tbody id="validDataBody">
                      <!-- 목업 데이터 (JavaScript로 대체됨) -->
                      <tr>
                        <td>(자동생성)</td>
                        <td>순환 펌프</td>
                        <td>EQPMT</td>
                        <td>SEOUL</td>
                        <td>EQ</td>
                        <td>PMP</td>
                        <td>Acme Pumps</td>
                        <td>M-100</td>
                      </tr>
                      <tr>
                        <td>PLT1000002</td>
                        <td>에어 컴프레서</td>
                        <td>EQPMT</td>
                        <td>SEOUL</td>
                        <td>EQ</td>
                        <td>CMP</td>
                        <td>Atlas Copco</td>
                        <td>GA15</td>
                      </tr>
                      <tr>
                        <td>PLT1000003</td>
                        <td>냉각 펌프</td>
                        <td>EQPMT</td>
                        <td>BUSAN</td>
                        <td>EQ</td>
                        <td>PMP</td>
                        <td>Grundfos</td>
                        <td>CR-150</td>
                      </tr>
                    </tbody>
                  </table>
                  
                  <!-- 저장/취소 버튼 -->
                  <div class="actions actions-top-medium">
                    <button id="cancelBtn" class="btn">취소</button>
                    <button id="saveBtn" class="btn primary">저장</button>
                  </div>
                </div>
              </div>

              <!-- 오류 섹션 -->
              <div class="section" id="errorSection" hidden>
                <div class="section-title">검증 오류</div>
                <div class="section-desc">오류가 발생한 행은 저장되지 않습니다.</div>
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width:100px">행 번호</th>
                      <th>오류 메시지</th>
                    </tr>
                  </thead>
                  <tbody id="errorBody">
                    <!-- 목업 데이터 (JavaScript로 대체됨) -->
                    <tr>
                      <td>3</td>
                      <td>name은 필수입니다</td>
                    </tr>
                    <tr>
                      <td>5</td>
                      <td>CSV 내에서 중복된 설비 ID: PLT001</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        </div>
        </main>
      </section>
    </div>
    
    <!-- 인라인 스크립트는 plant.js로 이관됨 -->
  </body>
</html>
