<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>설비 이력 조회 · CMMS</title>
    <!-- common CSS is loaded via layout/defaultLayout -->
    <!-- local fallback for design-only preview without server -->
    <link rel="stylesheet" href="../../static/assets/css/base.css" />
    <link rel="stylesheet" href="../../static/assets/css/print.css" />
  </head>
  <body>
    <div class="page">
      <!-- Main Content -->
      <section data-slot-root th:fragment="content" data-page="plant-history" data-module="plant-history">
        <main>
          <div class="container">
            <!-- 설비 번호 입력 섹션 -->
            <section class="card">
              <div class="card-header">
                <div class="card-title">설비 이력 조회</div>
                <div class="toolbar">
                  <a class="btn" th:href="@{/plant/list}">목록</a>
                  <button class="btn" data-print-btn th:if="${plant != null}">인쇄</button>
                </div>
              </div>
              <div class="card-body">
                <form method="get" action="/plant/history">
                  <div class="grid cols-12">
                    <div class="col-span-8">
                      <input class="input" name="plantId" 
                             th:value="${plantId}" 
                             placeholder="설비번호를 입력하세요 (예: P001)" 
                             required />
                    </div>
                    <div class="col-span-4">
                      <button type="submit" class="btn primary">조회</button>
                    </div>
                  </div>
                </form>
                
                <!-- 오류 메시지 -->
                <div class="notice danger" th:if="${errorMessage}" th:text="${errorMessage}">
                  설비 정보를 찾을 수 없습니다.
                </div>
              </div>
            </section>

            <!-- 설비 정보 섹션 -->
            <section class="card" th:if="${plant != null}">
              <div class="card-header">
                <div class="card-title">설비 정보</div>
              </div>
              <div class="card-body">
                <div class="section">
                  <div class="section-title">기본정보</div>
                  <div class="grid cols-12">
                    <!-- 1행: 설비번호, 설비명 -->
                    <div class="stack col-span-3"><div class="label">설비번호</div><div th:text="${plant.plantId}">EQP000123</div></div>
                    <div class="stack col-span-9"><div class="label">설비명</div><div th:text="${plant.name}">순환 펌프</div></div>
                    <!-- 2행: 자산유형, Site, 관리부서, 기능위치 -->
                    <div class="stack col-span-3"><div class="label">자산유형</div><div th:text="${plant.assetId ?: '-'}">EQPMT</div></div>
                    <div class="stack col-span-3"><div class="label">Site</div><div th:text="${plant.siteId ?: '-'}">SEOUL</div></div>
                    <div class="stack col-span-3"><div class="label">관리부서</div><div th:text="${plant.deptId ?: '-'}">설비과</div></div>
                    <div class="stack col-span-3"><div class="label">기능위치</div><div th:text="${plant.funcId ?: '-'}">PMP</div></div>
                    <!-- 비고 -->
                    <div class="stack col-span-12"><div class="label">비고</div><div th:text="${plant.note ?: '-'}">정기점검 대상 설비</div></div>
                  </div>
                </div>

                <div class="section">
                  <div class="section-title">사양 / 모델</div>
                  <div class="grid cols-12">
                    <div class="stack col-span-4"><div class="label">제조사</div><div th:text="${plant.makerName ?: '-'}">Acme</div></div>
                    <div class="stack col-span-4"><div class="label">모델</div><div th:text="${plant.model ?: '-'}">AX-100</div></div>
                    <div class="stack col-span-4"><div class="label">시리얼</div><div th:text="${plant.serial ?: '-'}">SN123456</div></div>
                    <div class="stack col-span-12"><div class="label">스펙</div><div th:text="${plant.spec ?: '-'}">압력 10~30 bar, 용량 40 m³/h</div></div>
                  </div>
                </div>

                <div class="section">
                  <div class="section-title">설치 / 감가상각</div>
                  <div class="grid cols-12">
                    <!-- 1행: 설치일 단독 표시 -->
                    <div class="stack col-span-12"><div class="label">설치일</div><div th:text="${plant.installDate ?: '-'}">2022-06-01</div></div>
                    <!-- 2행: 감가유형, 감가기간, 취득가, 잔존가 -->
                    <div class="stack col-span-3"><div class="label">감가유형</div><div th:text="${plant.depreId ?: '-'}">SL</div></div>
                    <div class="stack col-span-3"><div class="label">감가기간(년)</div><div th:text="${plant.deprePeriod ?: '-'}">10</div></div>
                    <div class="stack col-span-3"><div class="label">취득가</div><div th:text="${plant.purchaseCost != null ? #numbers.formatInteger(plant.purchaseCost, 0, 'COMMA') : '-'}">120,000,000</div></div>
                    <div class="stack col-span-3"><div class="label">잔존가</div><div th:text="${plant.residualValue != null ? #numbers.formatInteger(plant.residualValue, 0, 'COMMA') : '-'}">12,000,000</div></div>
                  </div>
                </div>

                <div class="section">
                  <div class="section-title">운영 / 안전</div>
                  <div class="grid cols-12">
                    <div class="stack col-span-3"><div class="label">점검대상</div><div><span class="badge" th:text="${plant.inspectionYn}" th:classappend="${plant.inspectionYn == 'Y' ? 'badge' : 'badge danger'}">Y</span></div></div>
                    <div class="stack col-span-3"><div class="label">PSM 대상</div><div><span class="badge" th:text="${plant.psmYn}" th:classappend="${plant.psmYn == 'Y' ? 'badge danger' : 'badge'}">N</span></div></div>
                    <div class="stack col-span-3"><div class="label">작업허가 대상</div><div><span class="badge" th:text="${plant.workpermitYn}" th:classappend="${plant.workpermitYn == 'Y' ? 'badge danger' : 'badge'}">Y</span></div></div>
                    <div class="stack col-span-3"><div class="label">점검주기(개월)</div><div th:text="${plant.inspectionInterval ?: '-'}">3</div></div>
                    <div class="stack col-span-3"><div class="label">최종 점검일</div><div th:text="${plant.lastInspection ?: '-'}">2025-01-01</div></div>
                    <div class="stack col-span-3"><div class="label">다음 점검일</div><div th:text="${plant.nextInspection ?: '-'}">2025-04-01</div></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- 예방점검 이력 섹션 -->
            <section class="card" th:if="${inspections != null and !inspections.isEmpty()}">
              <div class="card-header">
                <div class="card-title">예방점검 이력 (최근 5건)</div>
              </div>
              <div class="card-body">
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width:140px">점검번호</th>
                      <th>점검명</th>
                      <th style="width:100px">작업유형</th>
                      <th style="width:140px">계획일</th>
                      <th style="width:140px">실적일</th>
                      <th style="width:100px">상태</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="item : ${inspections}">
                      <td th:text="${item.inspectionId}">I250101001</td>
                      <td th:text="${item.name}">정기 점검</td>
                      <td th:text="${item.jobId ?: '-'}">PM</td>
                      <td th:text="${item.plannedDate ?: '-'}">2025-01-15</td>
                      <td th:text="${item.actualDate ?: '-'}">2025-01-16</td>
                      <td>
                        <span class="badge" 
                              th:classappend="${item.status == 'PLAN' ? '' : (item.status == 'PROC' ? 'warning' : 'success')}"
                              th:text="${item.status == 'PLAN' ? '계획' : (item.status == 'PROC' ? '진행' : '완료')}">
                          완료
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <!-- 작업오더 이력 섹션 -->
            <section class="card" th:if="${workorders != null and !workorders.isEmpty()}">
              <div class="card-header">
                <div class="card-title">작업오더 이력 (최근 5건)</div>
              </div>
              <div class="card-body">
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width:140px">작업번호</th>
                      <th>작업명</th>
                      <th style="width:100px">작업유형</th>
                      <th style="width:140px">계획일</th>
                      <th style="width:140px">실적일</th>
                      <th style="width:100px">상태</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="item : ${workorders}">
                      <td th:text="${item.orderId}">O250101001</td>
                      <td th:text="${item.name}">긴급 수리</td>
                      <td th:text="${item.jobId ?: '-'}">CM</td>
                      <td th:text="${item.plannedDate ?: '-'}">2025-01-15</td>
                      <td th:text="${item.actualDate ?: '-'}">2025-01-16</td>
                      <td>
                        <span class="badge" 
                              th:classappend="${item.status == 'PLAN' ? '' : (item.status == 'PROC' ? 'warning' : 'success')}"
                              th:text="${item.status == 'PLAN' ? '계획' : (item.status == 'PROC' ? '진행' : '완료')}">
                          완료
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <!-- 작업허가 이력 섹션 -->
            <section class="card" th:if="${workpermits != null and !workpermits.isEmpty()}">
              <div class="card-header">
                <div class="card-title">작업허가 이력 (최근 5건)</div>
              </div>
              <div class="card-body">
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width:140px">허가번호</th>
                      <th>작업명</th>
                      <th style="width:100px">작업유형</th>
                      <th style="width:140px">신청일</th>
                      <th style="width:140px">승인일</th>
                      <th style="width:100px">상태</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="item : ${workpermits}">
                      <td th:text="${item.permitId}">W250101001</td>
                      <td th:text="${item.name}">작업 허가</td>
                      <td th:text="${item.jobId ?: '-'}">HOT</td>
                      <td th:text="${item.plannedDate ?: '-'}">2025-01-15</td>
                      <td th:text="${item.actualDate ?: '-'}">2025-01-16</td>
                      <td>
                        <span class="badge" 
                              th:classappend="${item.status == 'PLAN' ? '' : (item.status == 'PROC' ? 'warning' : 'success')}"
                              th:text="${item.status == 'PLAN' ? '계획' : (item.status == 'PROC' ? '진행' : '완료')}">
                          완료
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <!-- 출력 문서 형식 -->
            <section class="print-form" th:if="${plant != null}" aria-hidden="true">
              <div class="doc">
                <div class="doc-header">
                  <div class="doc-title">설비 이력 조회</div>
                  <div class="doc-meta">
                    <div class="meta-row">출력일시: <span id="print-date">-</span></div>
                    <div class="meta-row">인쇄자: <span id="print-user">-</span></div>
                  </div>
                </div>

                <div class="section">
                  <div class="section-title">1. 기본정보</div>
                  <table class="row-cols-4">
                    <tr>
                      <th>설비번호</th><td th:text="${plant.plantId}">EQP000123</td>
                      <th>설비명</th><td th:text="${plant.name}">순환 펌프</td>
                    </tr>
                    <tr>
                      <th>자산유형</th><td th:text="${plant.assetId}">EQPMT</td>
                      <th>Site</th><td th:text="${plant.siteId}">SEOUL</td>
                    </tr>
                    <tr>
                      <th>관리부서</th><td th:text="${plant.deptId}">설비팀</td>
                      <th>기능위치</th><td th:text="${plant.funcId}">PMP</td>
                    </tr>
                  </table>
                </div>

                <div class="section">
                  <div class="section-title">2. 규격 / 모델</div>
                  <table class="row-cols-4">
                    <tr>
                      <th>제조사</th><td th:text="${plant.makerName ?: '-'}">Acme</td>
                      <th>모델</th><td th:text="${plant.model ?: '-'}">AX-100</td>
                    </tr>
                    <tr>
                      <th>시리얼</th><td th:text="${plant.serial ?: '-'}">SN123456</td>
                      <th>스펙</th><td th:text="${plant.spec ?: '-'}">압력 10~30 bar, 유량 40 m³/h</td>
                    </tr>
                  </table>
                </div>

                <div class="section">
                  <div class="section-title">3. 설치 / 감가상각</div>
                  <table class="row-cols-4">
                    <tr>
                      <th>설치일</th><td th:text="${plant.installDate ?: '-'}">2022-06-01</td>
                      <th>감가유형</th><td th:text="${plant.depreId ?: '-'}">SL</td>
                    </tr>
                    <tr>
                      <th>감가기간(년)</th><td th:text="${plant.deprePeriod ?: '-'}">10</td>
                      <th>취득가</th><td th:text="${plant.purchaseCost ?: '-'}">120,000,000</td>
                    </tr>
                    <tr>
                      <th>잔존가</th><td th:text="${plant.residualValue ?: '-'}">12,000,000</td>
                      <th class="muted">비고</th><td class="muted" th:text="${plant.note ?: '-'}">-</td>
                    </tr>
                  </table>
                </div>

                <div class="section">
                  <div class="section-title">4. 운영 / 점검</div>
                  <table class="row-cols-4">
                    <tr>
                      <th>점검대상</th><td th:text="${plant.inspectionYn}">Y</td>
                      <th>PSM 여부</th><td th:text="${plant.psmYn}">N</td>
                    </tr>
                    <tr>
                      <th>작업허가대상</th><td th:text="${plant.workpermitYn}">Y</td>
                      <th>점검주기(개월)</th><td th:text="${plant.inspectionInterval ?: '-'}">3</td>
                    </tr>
                    <tr>
                      <th>최종 점검일</th><td th:text="${plant.lastInspection ?: '-'}">2025-01-01</td>
                      <th>다음 점검일</th><td th:text="${plant.nextInspection ?: '-'}">2025-04-01</td>
                    </tr>
                  </table>
                </div>

                <!-- 예방점검 이력 -->
                <div class="section" th:if="${inspections != null and !inspections.isEmpty()}">
                  <div class="section-title">5. 예방점검 이력 (최근 5건)</div>
                  <table class="row-cols-6">
                    <thead>
                      <tr>
                        <th>점검번호</th>
                        <th>점검명</th>
                        <th>작업유형</th>
                        <th>계획일</th>
                        <th>실적일</th>
                        <th>상태</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="item : ${inspections}">
                        <td th:text="${item.inspectionId}">I250101001</td>
                        <td th:text="${item.name}">정기 점검</td>
                        <td th:text="${item.jobId ?: '-'}">PM</td>
                        <td th:text="${item.plannedDate ?: '-'}">2025-01-15</td>
                        <td th:text="${item.actualDate ?: '-'}">2025-01-16</td>
                        <td th:text="${item.status == 'PLAN' ? '계획' : (item.status == 'PROC' ? '진행' : '완료')}">완료</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- 작업오더 이력 -->
                <div class="section" th:if="${workorders != null and !workorders.isEmpty()}">
                  <div class="section-title">6. 작업오더 이력 (최근 5건)</div>
                  <table class="row-cols-6">
                    <thead>
                      <tr>
                        <th>작업번호</th>
                        <th>작업명</th>
                        <th>작업유형</th>
                        <th>계획일</th>
                        <th>실적일</th>
                        <th>상태</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="item : ${workorders}">
                        <td th:text="${item.orderId}">O250101001</td>
                        <td th:text="${item.name}">긴급 수리</td>
                        <td th:text="${item.jobId ?: '-'}">CM</td>
                        <td th:text="${item.plannedDate ?: '-'}">2025-01-15</td>
                        <td th:text="${item.actualDate ?: '-'}">2025-01-16</td>
                        <td th:text="${item.status == 'PLAN' ? '계획' : (item.status == 'PROC' ? '진행' : '완료')}">완료</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- 작업허가 이력 -->
                <div class="section" th:if="${workpermits != null and !workpermits.isEmpty()}">
                  <div class="section-title">7. 작업허가 이력 (최근 5건)</div>
                  <table class="row-cols-6">
                    <thead>
                      <tr>
                        <th>허가번호</th>
                        <th>작업명</th>
                        <th>작업유형</th>
                        <th>신청일</th>
                        <th>승인일</th>
                        <th>상태</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="item : ${workpermits}">
                        <td th:text="${item.permitId}">W250101001</td>
                        <td th:text="${item.name}">작업 허가</td>
                        <td th:text="${item.jobId ?: '-'}">HOT</td>
                        <td th:text="${item.plannedDate ?: '-'}">2025-01-15</td>
                        <td th:text="${item.actualDate ?: '-'}">2025-01-16</td>
                        <td th:text="${item.status == 'PLAN' ? '계획' : (item.status == 'PROC' ? '진행' : '완료')}">완료</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </section>
          </div>
        </main>
      </section>
    </div>
    
    <!-- 인라인 스크립트는 plant.js로 이관됨 -->
  </body>
  </html>
